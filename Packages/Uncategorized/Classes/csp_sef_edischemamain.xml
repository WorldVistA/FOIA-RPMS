<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for UNIX (Red Hat Enterprise Linux for x86-64) 2014.1.3 (Build 775U)" ts="2019-07-17 13:16:22">
<Class name="csp.sef.edischemamain">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>CSPX.AutoPageCSP</Super>
<TimeChanged>61501,53312.757117</TimeChanged>
<TimeCreated>61501,53312.73928</TimeCreated>
<GeneratedBy>/csp/goldb/SEF/EDISchemaMain.csp</GeneratedBy>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""onLoadBody();"">"
	Write !,"<table border=""0"" class=""LayoutMain"" width=""100%"" cellpadding=""0"" cellspacing=""0"">"
	Do ..WriteTitlePane("@Ensemble:X12ManagerSchemas@Ensemble EDI Schemas")
	Write !,"</table>"
	Write !,!,"<div class=""Text1"">"
	Write (tFamily)_" schema Categories / Implementation Guides and the<br>Transaction Set implementation Names they define are displayed below:"
	Write "</div>"
	Write !,!,"<table border=1 cellpadding=4 cellspacing=0 style=""margin-left: 20px;""><tr>",!
	Write !,"<tr><th>Category</th><th>Name</th><th>Base</th><th>Description</th></tr>",!
	Write !
	#Include EnsEDISEF
	Set cat="" For { Set cat=$o($$$vaSchemaGbl(cat))  Quit:cat=""
	If $P($$$vaSchemaGbl(cat),"|",5) = tFamily { // Only show schemas from the current family
	Set sorted("="_cat)=""
	}
	}
	Set sortcat="" For { Set sortcat=$o(sorted(sortcat)) Quit:sortcat=""
	set cat=$e(sortcat,2,99999)
	set catdesc=##class(EnsLib.EDI.SEF.Schema).GetDescription("IG:"_cat)
	set base=$get($$$vaSchemaGbl(cat,"base")) Set:""=base base="&nbsp;"
	&html<<tr>>
	set rowdesc="",item="" For rows=0:1 { Set item=$O($$$vaSchemaGbl(cat,item))  Set:""=rowdesc rowdesc=##class(EnsLib.EDI.SEF.Schema).GetDescription("TS:"_cat_":"_item)  Quit:item="" } ; get rows count
	set item=$o($$$vaSchemaGbl(cat,""))
	set itemdesc=##class(EnsLib.EDI.SEF.Schema).GetDescription("TS:"_cat_":"_item)
	Set desc=$S(itemdesc'=catdesc:catdesc, 1:"")_$S(""'=rowdesc||(""=catdesc):$S(""'=catdesc&&(itemdesc'=catdesc):"<br>",1:"")_" - "_itemdesc, 1:"")
	&html<
	<td#($S(rows:" rowspan="_rows,1:""))#>#(cat)#</td>
	<td><a title='TS:#(cat)#:#(item)#' href='EnsLib.EDI.SEF.HTMLViewer.cls?DocType=#(cat)#:#(item)#'>#(item)#</a></td>
	<td#($S(rows:" rowspan="_rows,1:""))#>#(base)#</td>
	<td#($S('rowdesc:" rowspan="_rows,1:""))#>#(desc)#</td>>
	For { Set item=$O($$$vaSchemaGbl(cat,item))  Quit:item=""
	set:rowdesc itemdesc=" - "_##class(EnsLib.EDI.SEF.Schema).GetDescription("TS:"_cat_":"_item)
	&html<</tr>>
	&html<<tr>>
	&html<<td><a title='TS:#(cat)#:#(item)#' href='EnsLib.EDI.SEF.HTMLViewer.cls?DocType=#(cat)#:#(item)#'>#(item)#</a></td>
	<td>#($S(rowdesc:itemdesc,1:""))#</td>>
	}
	&html<</tr>>
	}
	Write !,!,"</table>",!
	Write "<form name=""theForm"" action=""EDISchemaMain.csp"" method=get>"
	Write !,..InsertHiddenFields("EDISchemaMain.csp"),!
	Write !,"	"
	Write "<input type=""hidden"" name=""SUBMIT_OPERATION"" value="""">"
	Write !,"	"
	Write "<input type=""hidden"" name=""FAMILY"" value="""_(tFamily)_""">"
	Write !,"	<table class=""AutoForm"" cellpadding=4><tr>",!
	Write "		<td>",!
	Write "		</td><td align=center>",!
	Write " 			"
	Write "<input type=""button"" name=""BTN_Import"" value=""Import From SEF File"" onclick=""btnImportSEF();"">"
	Write "&nbsp;",!
	Write "		</td><td rowspan=2 align=center>",!
	Write " 			"
	Write "<input TYPE=""file"" NAME=""FILE"" VALUE="""" SIZE=""30"">"
	Write !,"		</td>",!
	Write "	</tr><tr>",!
	Write "		<td>",!
	Write "		</td><td align=center>",!
	Write " 			"
	Write "<input type=""button"" name=""BTN_Import"" value=""Import From XML File"" onclick=""btnImport();"">"
	Write "&nbsp;",!
	Write "		</td>",!
	Write "	</tr><tr>",!
	Write "		<td rowspan=2>Choose Category<br>"
	Write "<select name=""CATEGORY"">"
	Write !,"		"
	&html<<option value=""></option>>
	Set sortcat="" For { Set sortcat=$o(sorted(sortcat)) Quit:sortcat=""
	set cat=$e(sortcat,2,99999)
	&html<<option value="#(cat)#">#(cat)#</option>>
	}
	Write !,"		"
	Write "</select>"
	Write "</td>",!
	Write "		<td align=center>",!
	Write "			"
	Write "<input type=""button"" name=""BTN_Export"" value=""Export To File"" onclick=""btnExport();"">"
	Write "&nbsp;",!
	Write "		</td><td>",!
	Write "			"
	Write "<input TYPE=""text"" NAME=""OUTFILE"" VALUE="""" SIZE=""30"">"
	Write !,"    	</td>",!
	Write "	</tr><tr>",!
	Write "		<td align=center>",!
	Write "			"
	Write "<input type=""button"" name=""BTN_Remove"" value=""Remove Category"" onclick=""btnRemove();"">"
	Write !,"		</td><td>",!
	Write "		</td>",!
	Write "    </tr></table>	",!
	Write "</form>"
	Write !,!,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !
	Set tFamily=$G(%request.Data("FAMILY",1),"X12")
	Write !,"<title>Ensemble "_(tFamily)_" Schemas</title>",!
	Write "<link rel=""stylesheet"" type=""text/css"" href=""/csp/sys/csputils.css"" title=""Standard Style""/>"
	Write !,"<style>"
	Write !,"/* apply some uniformity to buttons */",!
	Write "select, input {",!
	Write "	width: 20.0em;",!
	Write "}",!
	Write "</style>"
	Write !
	#Include EnsEDISEF
	Set SubmitOperation=$G(%request.Data("SUBMIT_OPERATION",1))
	Set:""=SubmitOperation SubmitOperation=$G(%session.Data("SUBMIT_OPERATION"))
	Kill %session.Data("SUBMIT_OPERATION")
	Set Filename="", (tSCImport,tSCExport)=$$$OK
	If "Import"=SubmitOperation || ("ImportSEF"=SubmitOperation) {
	Set Filename=$G(%request.Data("FILE",1))
	If ""=Filename||'##class(%File).Exists(Filename) {
	Set tSCImport=$$$ERROR($$$EnsErrGeneral,"Unable to open file '"_Filename_"'")
	}
	If ""'=Filename&&$$$ISOK(tSCImport) {
	If "ImportSEF"=SubmitOperation {
	Set tSCImport=##class(EnsLib.EDI.SEF.Compiler).Import(Filename,tFamily,.tCatImported)
	}
	}
	} ElseIf "Export"=SubmitOperation {
	Set OutFilename=$G(%request.Data("OUTFILE",1))
	Set OutCategory=$G(%request.Data("CATEGORY",1))
	Set:""'=(OutFilename_OutCategory) tSCExport=$System.OBJ.Export(OutCategory_".EDI",OutFilename,"-d")
	} ElseIf "Remove"=SubmitOperation {
	Set OutCategory=$G(%request.Data("CATEGORY",1))
	Set tKilled=$D($$$vaSchemaGbl(OutCategory))
	Kill:""'=OutCategory $$$vaSchemaGbl(OutCategory),$$$vaSchemaDescGbl(OutCategory)
	}
	Write !,!
	If '(($$$ISERR(tSCImport))) Goto %csp00001 ;{
	Write !,"<script language=""javascript"">"
	Write !,"function onLoadBody()",!
	Write "{",!
	Write "	alert(""Error importing from file '"_($ZCVT(Filename,"O","JS"))_"': "_($ZCVT($$$StatusDisplayString(tSCImport),"O","JS"))_""");",!
	Write "}",!
	Write "</script>"
	Write !
	Goto %csp00002 ;}
%csp00001	If '(($$$ISERR(tSCExport))) Goto %csp00003 ;{
	Write !,"<script language=""javascript"">"
	Write !,"function onLoadBody()",!
	Write "{",!
	Write "	alert(""Error exporting category '"_($ZCVT(OutCategory,"O","JS"))_"' to file '"_($ZCVT(Filename,"O","JS"))_"': "_($ZCVT($$$StatusDisplayString(tSCExport),"O","JS"))_""");",!
	Write "}",!
	Write "</script>"
	Write !
	Goto %csp00002 ;}
%csp00003	If '((("Import"=SubmitOperation)&&(""'=Filename))) Goto %csp00004 ;{
	Write !,"<script language=""javascript"">"
	Write !,"function onLoadBody()",!
	Write "{",!
	Write "	alert(""Imported schema category "_($ZCVT(tCatImported,"O","JS"))_" from file '"_($ZCVT(Filename,"O","JS"))_"'"");",!
	Write "}",!
	Write "</script>"
	Write !
	Goto %csp00002 ;}
%csp00004	If '((("Export"=SubmitOperation)&&(""'=(OutFilename_OutCategory)))) Goto %csp00005 ;{
	Write !,"<script language=""javascript"">"
	Write !,"function onLoadBody()",!
	Write "{",!
	Write "	alert(""Exported schema category '"_($ZCVT(OutCategory,"O","JS"))_"' to file '"_($ZCVT(OutFilename,"O","JS"))_"'"");",!
	Write "}",!
	Write "</script>"
	Write !
	Goto %csp00002 ;}
%csp00005	If '((("Remove"=SubmitOperation)&&(""'=OutCategory)&&tKilled)) Goto %csp00006 ;{
	Write !,"<script language=""javascript"">"
	Write !,"function onLoadBody()",!
	Write "{",!
	Write "	alert(""Removed schema category '"_($ZCVT(OutCategory,"O","JS"))_"'"");",!
	Write "}",!
	Write "</script>"
	Write !
	Goto %csp00002 ;}
%csp00006	;{
	Write !,"<script language=""javascript"">"
	Write !,"function onLoadBody()",!
	Write "{",!
	Write "}",!
	Write "</script>"
	Write !
%csp00002	;}
	Write !,!,"<script language=""javascript"">"
	Write !,!,"function btnRemove()",!
	Write "{",!
	Write "	var form = self.document.theForm;",!
	Write "	if (form.CATEGORY.value == '') {",!
	Write "		alert(""Please select a Category"");",!
	Write "		return false;",!
	Write "	}",!
	Write "	var a = (confirm('Remove Category '+form.CATEGORY.value+' ?'));",!
	Write "	if (!a) {",!
	Write "		return false;",!
	Write "	}",!
	Write "	form.FILE.value = """";",!
	Write "	form.OUTFILE.value = """";",!
	Write "	setSessionOperation(""Remove"");",!
	Write "	//form.SUBMIT_OPERATION.value = ""Remove"";",!
	Write "	form.submit();",!
	Write "	return true;",!
	Write "}",!
	Write !,"function btnExport()",!
	Write "{",!
	Write "	var form = self.document.theForm;",!
	Write "	if (form.CATEGORY.value == '') {",!
	Write "		alert(""Please select a Category"");",!
	Write "		return false;",!
	Write "	}",!
	Write "	if (form.OUTFILE.value == '') {",!
	Write "		alert(""Please specify a filename"");",!
	Write "		return false;",!
	Write "	}",!
	Write "	form.FILE.value = """";",!
	Write "	setSessionOperation(""Export"");",!
	Write "	//form.SUBMIT_OPERATION.value = ""Export"";",!
	Write "	form.submit();",!
	Write "	return true;",!
	Write "}",!
	Write !,"function getFileCat()",!
	Write "{",!
	Write "	var x = "_("cspHttpServerMethod")_"('"_(..Encrypt($listbuild("EnsLib.EDI.SEF.SchemaXML.GetImportCategory:csp.sef.edischemamain"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',self.document.theForm.FILE.value);",!
	Write "	return x; ",!
	Write "}",!
	Write !,"function getSEFFileCat()",!
	Write "{",!
	Write "	var x = "_("cspHttpServerMethod")_"('"_(..Encrypt($listbuild("EnsLib.EDI.SEF.Compiler.GetImportCategory:csp.sef.edischemamain"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',self.document.theForm.FILE.value);",!
	Write "	return x; ",!
	Write "}",!
	Write !,"function setSessionOperation(OperationName)",!
	Write "{",!
	Write "	var x = "_("cspHttpServerMethod")_"('"_(..Encrypt($listbuild("csp.sef.edischemamain.SetSessionSubmitOperation"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',OperationName)",!
	Write "	return x; ",!
	Write "}",!
	Write !,"</script>"
	Write !
	#Include EnsEDISEF
	Write "<script language=""javascript"">",!
	&html<
	function btnImport()
	{>
	Write "    var catList=new Array();",!
	Set cat="" For { Set cat=$o($$$vaSchemaGbl(cat)) Quit:cat=""
	Write "    catList['"_cat_"'] = 1;",!
	}
	&html<
	var form = self.document.theForm;
	if (form.FILE.value == '') {
	alert("Please specify a filename");
	return false;
	}
	var fileCat = getFileCat();
	if ((fileCat != '') && (catList[fileCat] != null)) {
	var a = (confirm('Overwrite Category '+fileCat+' by loading from file '+form.FILE.value+' ?'));
	if (!a) {
	return false;
	}
	}
	form.CATEGORY.value = "";
	setSessionOperation("Import");
	//form.SUBMIT_OPERATION.value = "Import";
	form.submit();
	return true;
	}
	function btnImportSEF()
	{>
	Write "    var catList=new Array();",!
	Set cat="" For { Set cat=$o($$$vaSchemaGbl(cat)) Quit:cat=""
	Write "    catList['"_cat_"'] = 1;",!
	}
	&html<
	var form = self.document.theForm;
	if (form.FILE.value == '') {
	alert("Please specify a filename");
	return false;
	}
	var fileCat = getSEFFileCat();
	if ((fileCat != '') && (catList[fileCat] != null)) {
	var a = (confirm('Overwrite Category '+fileCat+' by loading from SEF file '+form.FILE.value+' ?'));
	if (!a) {
	return false;
	}
	}
	form.CATEGORY.value = "";
	setSessionOperation("ImportSEF");
	//form.SUBMIT_OPERATION.value = "ImportSEF";
	form.submit();
	return true;
	}>
	Write "<"_$C(47)_"script>",!
	Write !,(..HyperEventHead(0,0))
	Write !,!,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,!,!,!,"</html>"
]]></Implementation>
</Method>

<Method name="SetSessionSubmitOperation">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>pOperationName</FormalSpec>
<Language>cache</Language>
<Implementation><![CDATA[
 	Set %session.Data("SUBMIT_OPERATION")=pOperationName
 	Quit 1
 
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>C:\InterSystems\Ensemble\CSP\goldb\SEF\EDISchemaMain.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/goldb/SEF/EDISchemaMain.csp</Default>
</Parameter>

<Parameter name="DOMAIN">
<Default>Ensemble</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>61286,9120</Default>
</Parameter>

<Parameter name="PAGENAME">
<Default>EDI Schemas</Default>
</Parameter>

<Parameter name="PARENTPAGE">
<Default>../UtilEnsEDIMain.csp</Default>
</Parameter>
</Class>
</Export>
